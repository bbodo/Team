<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Board">  
  
 	<!-- 페이징된 리스트 가져오기 -->
	<select id="BoardList"
			resultType="com.green.board.vo.BoardVo">
	
	SELECT * FROM
	(
		SELECT
			ROW_NUMBER() OVER(ORDER BY NREF DESC, STEP ASC)  RNUM,
			B.BOARD_IDX,
			B.SUBMENU_ID,
			B.BOARD_TITLE,
			B.BOARD_CONT,
			B.USERCODE,
			TO_CHAR(B.BOARD_REGDATE, 'YYYY-MM-DD HH24:MI:SS') BOARD_REGDATE,
			B.READCOUNT,
			B.BNUM,
			B.LVL,
			B.STEP,
			B.NREF,
			B.DELBOARD,
			B.PARENT,
			M.USERNAME
		FROM
			BOARD B
		JOIN 
			MEMBER M
		ON 
			B.USERCODE = M.USERCODE
		<if test="menu_id != null or menu_id !=''">
        WHERE     
          SUBMENU_ID  =  #{submenu_id}
       </if>    
	) T 
	WHERE 
		T.RNUM BETWEEN #{startnum} AND #{endnum}
	ORDER BY
		 NREF  DESC, STEP   ASC   
		
	</select>
	
	<!-- 전체 자료수 조회 -->
	<select   id             = "GetTotalCount"
	          parameterType  = "hashmap"
	          resultType     = "_int">
	          
		SELECT
	    	COUNT( BOARD_IDX )  AS   TOTALCOUNT
		FROM   
	    	BOARD
	    <if test="submenu_id != null or submenu_id != ''"> 
		WHERE
			SUBMENU_ID = #{ submenu_id }
	    </if>
	    
	</select>
  
  	<!-- 답글일때 원글 정보 가져가기 -->
	<select   id             = "GetBoard"
	          resultType     = "com.green.board.vo.BoardVo">
		
		SELECT 
			B.BOARD_IDX,
			B.SUBMENU_ID,
			B.BOARD_TITLE,
			B.BOARD_CONT,
			B.MARKET_VALUE,
			B.USERCODE,
			B.MANAGERCODE,
			TO_CHAR(B.BOARD_REGDATE, 'YYYY-MM-DD HH24:MI:SS') BOARD_REGDATE,
			B.READCOUNT,
			B.BNUM,
			B.LVL,
			B.STEP,
			B.B.NREF,
			B.DELBOARD,
			B.PARENT,
			M.USERNAME
		FROM
			BOARD B
		JOIN
			MEMBER M
		ON
			B.USERCODE = M.USERCODE
		WHERE
			BOARD_IDX = #{ board_idx }

	</select>  

</mapper>





   