<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Manager">  
  
  	<!-- 유저 정보 가져가기 -->
	<select id="GetAllUser"
			resultType="com.green.user.vo.UserVo">
	
		SELECT
 			USERCODE,
 			USERID,
			PASSWD,
			USERNAME,
			BIRTHDAY,
			GENDER,
			GRADE,
			ADDR,
			EMAIL,
			TO_CHAR( JOINDATE, 'YYYY-MM-DD HH24:MI:SS' ) AS JOINDATE,
			POINT,
			DELMEM,
			NICKNAME
 		FROM
 			MEMBER
 		WHERE
 			DELMEM &lt;= 0
		ORDER BY
			USERCODE DESC
			
	</select>
 	
 	<!-- 유저 정보 담아가기 -->
 	<select id="GetUser"
 			resultType="com.green.user.vo.UserVo">
 	
 		SELECT
 			USERCODE,
 			USERID,
			PASSWD,
			USERNAME,
			BIRTHDAY,
			GENDER,
			GRADE,
			ADDR,
			EMAIL,
			TO_CHAR( JOINDATE, 'YYYY-MM-DD HH24:MI:SS' ) AS JOINDATE,
			POINT,
			DELMEM,
			NICKNAME
 		FROM
 			MEMBER
 		WHERE
 			USERCODE = #{ usercode }
 	
 	</select>
 	
 	<!-- 유저 정보 수정 -->
 	<update id="UpdateUser">
 	
 		UPDATE
 			MEMBER
 		SET
			PASSWD   = #{ passwd },
			USERNAME = #{ username },
			BIRTHDAY = #{ birthday },
			GENDER   = #{ gender },
			GRADE    = #{ grade },
			ADDR     = #{ addr },
			EMAIL    = #{ email },
 			POINT     = #{ point }
 		WHERE
 			USERCODE = #{ usercode }
 			
 	</update>
 	
 	<!-- 유저 탈퇴 처리 -->
 	<delete id="DeleteUser">
 	
 		UPDATE
 			MEMBER
 		SET
 			DELMEM = 1
 		WHERE
 			USERCODE = #{ usercode }
 	
 	</delete>
 	
 <!-- 	<insert id="AddMenu">
 	
 		INSERT INTO
 			MENUS
 			(
	 			MENU_ID,
				MENU_NAME,
				MENU_SEQ
 			)
 			VALUES
 			(
 				#{ menu_id },
 				#{ menu_name },
 				#{ menu_seq }
 			)
 		
 	
 	</insert> -->
 	
 	<!-- 메뉴 등록 -->
 	<insert id="AddMenu2" >
      <selectKey keyProperty="menu_id,menu_seq"
         resultType="com.green.menus.vo.MenuVo" 
		 order="BEFORE" >
         SELECT menu_id,menu_seq
			 FROM
			( SELECT  'MENU' ||
			   TRIM( TO_CHAR( SUBSTR( NVL( MAX(MENU_ID), 'MENU00'), 5, 2 ) +1, '00') )  AS MENU_ID
			  FROM MENUS) menu_id, 			
			(SELECT   NVL( MAX(MENU_SEQ), 0 ) + 1 as menu_seq
			  FROM   MENUS) menu_seq
      </selectKey>           
		INSERT INTO
			MENUS 
			( 
				MENU_ID, 
				MENU_NAME,
				MENU_SEQ 
			)
			VALUES
			(
				#{menu_id},
				#{menu_name},
				#{menu_seq}
			)

    </insert>
 	
 	<!-- 메뉴수정 -->
 	<update id="UpdateMenu">
 	
 		UPDATE
 			MENUS
 		SET
 			MENU_NAME = #{ menu_name },
 			MENU_SEQ = #{ menu_seq }
 		WHERE
 			MENU_ID = #{ menu_id }
 			
 	</update>
 	
 	<!-- 메뉴 삭제 -->
 	<delete id="DeleteMenu">
 	
 		DELETE
 		FROM
 			MENUS
 		WHERE
 			MENU_ID = #{ menu_id }
 	
 	</delete>
 	
 	<!-- 서브메뉴 추가 -->
 	<insert id="AddSubMenu" >
      <selectKey keyProperty="submenu_id,submenu_seq"
         resultType="com.green.menus.vo.SubmenuVo" 
		 order="BEFORE" >
         SELECT submenu_id,submenu_seq
			 FROM
			( SELECT  'SUBMENU' ||
			   TRIM( TO_CHAR( SUBSTR( NVL( MAX(SUBMENU_ID), 'SUBMENU00'), 8, 2 ) +1, '00') )  AS SUBMENU_ID
			  FROM SUBMENUS) submenu_id, 			
			(SELECT   NVL( MAX(SUBMENU_SEQ), 0 ) + 1 as submenu_seq
			  FROM   SUBMENUS) submenu_seq
      </selectKey>           
		INSERT INTO
			SUBMENUS 
			( 
				SUBMENU_ID, 
				SUBMENU_NAME,
				SUBMENU_SEQ,
				MENU_ID 
			)
			VALUES
			(
				#{ submenu_id },
				#{ submenu_name },
				#{ submenu_seq },
				#{ menu_id }
			)

    </insert>
 	
 	<!-- 서브메뉴 삭제 -->
 	<delete id="DeleteSubmenu">
 	
 		DELETE
 		FROM
 			SUBMENUS
 		WHERE
 			SUBMENU_ID = #{ submenu_id }
 	
 	</delete>
 	
 	<update id="UpdateSubmenu">
 	
 		UPDATE
 			SUBMENUS
 		SET
 			MENU_ID = #{ menu_id },
 			SUBMENU_NAME = #{ submenu_name },
 			SUBMENU_SEQ = #{ submenu_seq}
 		WHERE
 			SUBMENU_ID = #{ submenu_id }
 	
 	</update>
 	
</mapper>





   