<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Manager">  
  
  	<!-- 유저 정보 가져가기 -->
	<select id="GetAllUser"
			resultType="com.green.user.vo.UserVo">
	
		SELECT
 			USERCODE,
 			USERID,
			PASSWD,
			USERNAME,
			BIRTHDAY,
			GENDER,
			GRADE,
			ADDR,
			EMAIL,
			TO_CHAR( JOINDATE, 'YYYY-MM-DD HH24:MI:SS' ) AS JOINDATE,
			POINT,
			DELMEM,
			NICKNAME
 		FROM
 			MEMBER
 		WHERE
 			DELMEM &lt;= 0
		ORDER BY
			USERCODE DESC
			
	</select>
 	
 	<!-- 유저 정보 담아가기 -->
 	<select id="GetUser"
 			resultType="com.green.user.vo.UserVo">
 	
 		SELECT
 			USERCODE,
 			USERID,
			PASSWD,
			USERNAME,
			BIRTHDAY,
			GENDER,
			GRADE,
			ADDR,
			EMAIL,
			TO_CHAR( JOINDATE, 'YYYY-MM-DD HH24:MI:SS' ) AS JOINDATE,
			POINT,
			DELMEM,
			NICKNAME
 		FROM
 			MEMBER
 		WHERE
 			USERCODE = #{ usercode }
 	
 	</select>
 	
 	<!-- 유저 정보 수정 -->
 	<update id="UpdateUser">
 	
 		UPDATE
 			MEMBER
 		SET
			PASSWD   = #{ passwd },
			USERNAME = #{ username },
			BIRTHDAY = #{ birthday },
			GENDER   = #{ gender },
			GRADE    = #{ grade },
			ADDR     = #{ addr },
			EMAIL    = #{ email },
 			POINT     = #{ point }
 		WHERE
 			USERCODE = #{ usercode }
 			
 	</update>
 	
 	<!-- 유저 탈퇴 처리 -->
 	<delete id="DeleteUser">
 	
 		UPDATE
 			MEMBER
 		SET
 			DELMEM = 1
 		WHERE
 			USERCODE = #{ usercode }
 	
 	</delete>
 	
 	<insert id="AddMenu">
 	
 		INSERT INTO
 			MENUS
 			(
	 			MENU_ID,
				MENU_NAME,
				MENU_SEQ
 			)
 			VALUES
 			(
 				#{ menu_id },
 				#{ menu_name },
 				#{ menu_seq }
 			)
 		
 	
 	</insert>
 	
 	<insert id="AddMenu2" >
      <selectKey keyProperty="menu_id,menu_seq"
         resultType="com.green.menus.vo.MenuVo" 
		 order="BEFORE" >
         SELECT menu_id,menu_seq
			 FROM
			( SELECT  'MENU' ||
			   TRIM( TO_CHAR( SUBSTR( NVL( MAX(MENU_ID), 'MENU00'), 5, 2 ) +1, '00') )  AS MENU_ID
			  FROM MENUS) menu_id, 			
			(SELECT   NVL( MAX(MENU_SEQ), 0 ) + 1 as menu_seq
			  FROM   MENUS) menu_seq
      </selectKey>           
		INSERT INTO
			MENUS 
			( 
				MENU_ID, 
				MENU_NAME,
				MENU_SEQ 
			)
			VALUES
			(
				#{menu_id},
				#{menu_name},
				#{menu_seq}
			)

    </insert>
 	
</mapper>





   